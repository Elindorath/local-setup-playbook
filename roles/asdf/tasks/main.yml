---
- name: Install asdf plugins
  ansible.builtin.command: "asdf plugin add {{ item.name }} {{ item.repository }}"
  with_items: "{{ asdf_plugins_to_install }}"
  register: result_plugin
  failed_when:
    - result_plugin.rc != 0
    - '"already added" not in result_plugin.stderr'

- name: Install asdf plugin tool versions
  ansible.builtin.command: "asdf install {{ item.0.name }} {{ item.1 }}"
  with_subelements:
    - "{{ asdf_plugins_to_install }}"
    - versions

- name: Set asdf plugin tool global versions
  ansible.builtin.command: "asdf global {{ item.name }} {{ item.global }}"
  with_items: "{{ asdf_plugins_to_install }}"
